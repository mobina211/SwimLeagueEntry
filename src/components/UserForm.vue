<template>
  <div class="min-h-screen flex items-center justify-center p-4 md:p-6 overflow-hidden relative">
    <!-- Background water effect -->
    <div class="absolute inset-0 overflow-hidden bg-gradient-to-br from-cyan-900 via-blue-900 to-sky-900">
      <!-- Water waves -->
      <div class="absolute bottom-0 left-0 right-0 h-48 bg-gradient-to-t from-cyan-500/20 to-transparent"></div>
      <div class="absolute top-0 left-0 right-0 h-32 bg-gradient-to-b from-white/5 to-transparent"></div>

      <!-- Pool lane lines -->
      <div class="absolute top-1/4 left-0 right-0 space-y-12 opacity-20">
        <div v-for="i in 8" :key="i" class="h-1 bg-gradient-to-r from-transparent via-cyan-400 to-transparent"></div>
      </div>

      <!-- Floating bubbles -->
      <div v-for="i in 15" :key="'bubble-' + i" :class="`absolute rounded-full bg-cyan-300/10 animate-float`" :style="`
          width: ${Math.random() * 30 + 10}px;
          height: ${Math.random() * 30 + 10}px;
          left: ${Math.random() * 100}%;
          top: ${Math.random() * 100}%;
          animation-delay: ${Math.random() * 3}s;
          animation-duration: ${Math.random() * 15 + 15}s;
        `">
      </div>
    </div>

    <!-- Main form -->
    <div class="relative z-10 w-full max-w-2xl mx-auto">
      <!-- Form header -->
      <div class="text-center mb-8 md:mb-12">
        <div class="inline-flex items-center justify-center mb-6">
          <div class="relative">
            <div
              class="w-16 h-16 rounded-full bg-gradient-to-r from-cyan-400 to-blue-500 flex items-center justify-center shadow-lg mr-4">
              <span class="text-3xl">ğŸŠ</span>
            </div>
            <div class="absolute -top-1 -right-1 w-5 h-5 rounded-full bg-cyan-300/60"></div>
          </div>
          <h1
            class="text-3xl md:text-4xl font-black bg-gradient-to-r from-cyan-300 to-blue-400 bg-clip-text text-transparent">
            ÙØ±Ù… Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ù†Ø§Ú¯Ø±
          </h1>
        </div>
        <p class="text-cyan-100/80 text-lg">Ù„Ø·ÙØ§ Ø§Ø·Ù„Ø§Ø¹Ø§Øª ØµØ­ÛŒØ­ Ùˆ Ú©Ø§Ù…Ù„ Ø´Ù†Ø§Ú¯Ø± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ù†Ù…Ø§ÛŒÛŒØ¯</p>
      </div>

      <!-- Form card -->
      <div
        class="bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-xl p-6 md:p-10 rounded-3xl shadow-2xl border border-white/20 relative overflow-hidden">
        <!-- Decorative water waves -->
        <div class="absolute top-0 left-0 right-0 h-2 bg-gradient-to-r from-cyan-400 via-blue-500 to-cyan-400"></div>
        <div class="absolute bottom-0 left-0 right-0 h-2 bg-gradient-to-r from-cyan-400 via-blue-500 to-cyan-400"></div>



        <!-- Form grid -->
        <!-- Form grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8">

          <!-- 1. Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ -->
          <div class="group">
            <label
              class="block mb-2 text-sm font-semibold text-cyan-100 group-focus-within:text-cyan-300 transition-colors">
              <div class="flex items-center mb-1">
                <span class="ml-2 text-lg">ğŸ‘¤</span>
                Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø´Ù†Ø§Ú¯Ø±
                <span class="text-red-400 mr-1">*</span>
              </div>
            </label>
            <input v-model="local.name" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø¹Ù„ÛŒ Ø±Ø¶Ø§ÛŒÛŒ" @input="validateName"
              @blur="validateName" :class="[
                'w-full px-4 py-3 bg-white/10 backdrop-blur-sm border rounded-xl text-white placeholder-cyan-100/50 transition-all duration-300 focus:outline-none focus:ring-2',
                errors.name
                  ? 'border-red-400/70 focus:border-red-400 focus:ring-red-400/30'
                  : local.name && !errors.name
                    ? 'border-green-400/70 focus:border-green-400 focus:ring-green-400/30'
                    : 'border-white/20 focus:border-cyan-400 focus:ring-cyan-400/30'
              ]">

            <div v-if="errors.name" class="mt-1 text-red-300 text-sm flex items-center animate-shake">
              <span class="ml-1">âš ï¸</span>{{ errors.name }}
            </div>
            <div v-else-if="local.name && !errors.name" class="mt-1 text-green-300 text-sm flex items-center">
              <span class="ml-1">âœ…</span> Ù†Ø§Ù… ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª
            </div>
          </div>

          <!-- 2. Ú©Ø¯ Ù…Ù„ÛŒ -->
          <div class="group">
            <label class="block mb-2 text-sm font-semibold text-cyan-100">
              <div class="flex items-center mb-1">
                <span class="ml-2 text-lg">ğŸ†”</span>
                Ú©Ø¯ Ù…Ù„ÛŒ
                <span class="text-red-400 mr-1">*</span>
              </div>
            </label>

            <input v-model="local.nationalCode" type="text" maxlength="10" placeholder=" Ø±Ù‚Ù…10 - Ù…Ø«Ø§Ù„:  1234567890"
              @input="validateNationalCode" @blur="validateNationalCode" :class="[
                'w-full px-4 py-3 bg-white/10 backdrop-blur-sm border rounded-xl dir-ltr text-white text-left placeholder-cyan-100/50 transition-all duration-300 focus:outline-none focus:ring-2',
                errors.nationalCode
                  ? 'border-red-400/70 focus:border-red-400 focus:ring-red-400/30'
                  : local.nationalCode && !errors.nationalCode
                    ? 'border-green-400/70 focus:border-green-400 focus:ring-green-400/30'
                    : 'border-white/20 focus:border-cyan-400 focus:ring-cyan-400/30'
              ]">

            <div v-if="errors.nationalCode" class="mt-1 text-red-300 text-sm flex items-center animate-shake">
              <span class="ml-1">âš ï¸</span>{{ errors.nationalCode }}
            </div>
            <div v-else-if="local.nationalCode && !errors.nationalCode"
              class="mt-1 text-green-300 text-sm flex items-center">
              <span class="ml-1">âœ…</span> Ú©Ø¯ Ù…Ù„ÛŒ Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª
            </div>
          </div>

          <!-- 3. Ù†Ø§Ù… Ù¾Ø¯Ø± -->
          <div class="group">
            <label class="block mb-2 text-sm font-semibold text-cyan-100">
              <div class="flex items-center mb-1">
                <span class="ml-2 text-lg">ğŸ‘¨</span>
                Ù†Ø§Ù… Ù¾Ø¯Ø±
                <span class="text-red-400 mr-1">*</span>
              </div>
            </label>
            <input v-model="local.fatherName" type="text" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø­Ù…Ø¯" @input="validateFatherName"
              @blur="validateFatherName" :class="[
                'w-full px-4 py-3 bg-white/10 backdrop-blur-sm border rounded-xl text-white placeholder-cyan-100/50 transition-all duration-300 focus:outline-none focus:ring-2',
                errors.fatherName
                  ? 'border-red-400/70 focus:border-red-400 focus:ring-red-400/30'
                  : local.fatherName && !errors.fatherName
                    ? 'border-green-400/70 focus:border-green-400 focus:ring-green-400/30'
                    : 'border-white/20 focus:border-cyan-400 focus:ring-cyan-400/30'
              ]">
            <div v-if="errors.fatherName" class="mt-1 text-red-300 text-sm flex items-center animate-shake">
              <span class="ml-1">âš ï¸</span>{{ errors.fatherName }}
            </div>
            <div v-else-if="local.fatherName && !errors.fatherName"
              class="mt-1 text-green-300 text-sm flex items-center">
              <span class="ml-1">âœ…</span> Ù†Ø§Ù… Ù¾Ø¯Ø± Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª
            </div>
          </div>

          <!-- 4. Ù†Ø§Ù… Ù…Ø¯Ø±Ø³Ù‡ ØªØ­ØµÛŒÙ„ÛŒ -->
          <div class="group">
            <label class="block mb-2 text-sm font-semibold text-cyan-100">
              <div class="flex items-center mb-1">
                <span class="ml-2 text-lg">ğŸ«</span>
                Ù†Ø§Ù… Ù…Ø¯Ø±Ø³Ù‡ Ø¯Ø±Ø­Ø§Ù„ ØªØ­ØµÛŒÙ„
                <span class="text-red-400 mr-1">*</span>
              </div>
            </label>

            <input v-model="local.schoolName" type="text" placeholder="Ù†Ø§Ù… Ù…Ø¯Ø±Ø³Ù‡ ØªØ­ØµÛŒÙ„ÛŒ" @input="validateSchoolName"
              @blur="validateSchoolName" :class="[
                'w-full px-4 py-3 bg-white/10 backdrop-blur-sm border rounded-xl text-white placeholder-cyan-100/50 transition-all duration-300 focus:outline-none focus:ring-2',
                errors.schoolName
                  ? 'border-red-400/70 focus:border-red-400 focus:ring-red-400/30'
                  : local.schoolName && !errors.schoolName
                    ? 'border-green-400/70 focus:border-green-400 focus:ring-green-400/30'
                    : 'border-white/20 focus:border-cyan-400 focus:ring-cyan-400/30'
              ]">

            <div v-if="errors.schoolName" class="mt-1 text-red-300 text-sm flex items-center animate-shake">
              <span class="ml-1">âš ï¸</span>{{ errors.schoolName }}
            </div>
            <div v-else-if="local.schoolName && !errors.schoolName"
              class="mt-1 text-green-300 text-sm flex items-center">
              <span class="ml-1">âœ…</span> Ù†Ø§Ù… Ù…Ø¯Ø±Ø³Ù‡ Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª
            </div>
          </div>

          <!-- 5. Ù†Ø§Ù… Ù…Ø±Ø¨ÛŒ Ø´Ù†Ø§ -->
          <div class="group">
            <label class="block mb-2 text-sm font-semibold text-cyan-100">
              <div class="flex items-center mb-1">
                <span class="ml-2 text-lg">ğŸ‘¨â€ğŸ«</span>
                Ù†Ø§Ù… Ù…Ø±Ø¨ÛŒ Ø´Ù†Ø§
                <span class="text-red-400 mr-1">*</span>
              </div>
            </label>

            <input v-model="local.coachName" type="text" placeholder="Ù†Ø§Ù… Ù…Ø±Ø¨ÛŒ Ø±Ø³Ù…ÛŒ" @input="validateCoachName"
              @blur="validateCoachName" :class="[
                'w-full px-4 py-3 bg-white/10 backdrop-blur-sm border rounded-xl text-white placeholder-cyan-100/50 transition-all duration-300 focus:outline-none focus:ring-2',
                errors.coachName
                  ? 'border-red-400/70 focus:border-red-400 focus:ring-red-400/30'
                  : local.coachName && !errors.coachName
                    ? 'border-green-400/70 focus:border-green-400 focus:ring-green-400/30'
                    : 'border-white/20 focus:border-cyan-400 focus:ring-cyan-400/30'
              ]">

            <div v-if="errors.coachName" class="mt-1 text-red-300 text-sm flex items-center animate-shake">
              <span class="ml-1">âš ï¸</span>{{ errors.coachName }}
            </div>
            <div v-else-if="local.coachName && !errors.coachName" class="mt-1 text-green-300 text-sm flex items-center">
              <span class="ml-1">âœ…</span> Ù†Ø§Ù… Ù…Ø±Ø¨ÛŒ Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª
            </div>
          </div>

          <!-- 6. Ù†Ø§Ù… Ø¨Ø§Ø´Ú¯Ø§Ù‡ Ø´Ù†Ø§ -->
          <div class="group">
            <label class="block mb-2 text-sm font-semibold text-cyan-100">
              <div class="flex items-center mb-1">
                <span class="ml-2 text-lg">ğŸŠ</span>
                Ù†Ø§Ù… Ù…Ø¯Ø±Ø³Ù‡ Ø´Ù†Ø§
                <span class="text-gray-400 mr-1 text-xs">(Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</span>
              </div>
            </label>

            <input v-model="local.swimSchoolName" type="text" placeholder="Ø¯Ø± ØµÙˆØ±Øª ÙˆØ¬ÙˆØ¯ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)"
              class="w-full px-4 py-3 bg-white/10 backdrop-blur-sm border border-white/20 rounded-xl text-white placeholder-cyan-100/50 transition-all duration-300 mb-6">
          </div>

          <!-- 7. Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³ -->
          <div class="group">
            <label class="block mb-2 text-sm font-semibold text-cyan-100">
              <div class="flex items-center mb-1">
                <span class="ml-2 text-lg">ğŸ“±</span>
                Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³ Ø§ÙˆÙ„ÛŒØ§
                <span class="text-red-400 mr-1">*</span>
              </div>
            </label>

            <input v-model="local.phone" type="tel" maxlength="11" placeholder="Û°Û¹Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹" @input="validatePhone"
              @blur="validatePhone" :class="[
                'w-full px-4 py-3 bg-white/10 backdrop-blur-sm border rounded-xl text-white text-left dir-ltr placeholder-cyan-100/50 transition-all duration-300 focus:outline-none focus:ring-2',
                errors.phone
                  ? 'border-red-400/70 focus:border-red-400 focus:ring-red-400/30'
                  : local.phone && !errors.phone
                    ? 'border-green-400/70 focus:border-green-400 focus:ring-green-400/30'
                    : 'border-white/20 focus:border-cyan-400 focus:ring-cyan-400/30'
              ]">

            <div v-if="errors.phone" class="mt-1 text-red-300 text-sm flex items-center animate-shake">
              <span class="ml-1">âš ï¸</span>{{ errors.phone }}
            </div>
            <div v-else-if="local.phone && !errors.phone" class="mt-1 text-green-300 text-sm flex items-center">
              <span class="ml-1">âœ…</span> Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³ Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª
            </div>
          </div>

          <!-- 8. Ø³Ø§Ù„ ØªÙˆÙ„Ø¯ -->
          <div class="group">
            <label class="block mb-2 text-sm font-semibold text-cyan-100">
              <div class="flex items-center mb-1">
                <span class="ml-2 text-lg">ğŸ‚</span>
                ØªØ§Ø±ÛŒØ® ØªÙˆÙ„Ø¯ Ø´Ù†Ø§Ú¯Ø±(ÙÙ‚Ø· Ø³Ø§Ù„)
                <span class="text-red-400 mr-1">*</span>
              </div>
            </label>

            <div class="relative">
              <input v-model="local.birthYear" type="number" placeholder="Ù…Ø«Ø§Ù„: Û±Û³Û¹Ûµ" min="1386" max="1398"
                @input="validateBirthYear" @blur="validateBirthYear" :class="[
                  'w-full px-4 py-3 bg-white/10 backdrop-blur-sm border rounded-xl dir-ltr pl-10 text-white placeholder-cyan-100/50 transition-all duration-300 focus:outline-none focus:ring-2',
                  errors.birthYear
                    ? 'border-red-400/70 focus:border-red-400 focus:ring-red-400/30'
                    : local.birthYear && !errors.birthYear
                      ? 'border-green-400/70 focus:border-green-400 focus:ring-green-400/30'
                      : 'border-white/20 focus:border-cyan-400 focus:ring-cyan-400/30'
                ]">
              <div class="absolute left-3 top-1/2 transform -translate-y-1/2 text-cyan-200/60">
                <span class="text-sm">Û±Û³</span>
              </div>
            </div>

            <div v-if="errors.birthYear" class="mt-1 text-red-300 text-sm flex items-center animate-shake">
              <span class="ml-1">âš ï¸</span>{{ errors.birthYear }}
            </div>
            <div v-else-if="local.birthYear && !errors.birthYear" class="mt-1 text-green-300 text-sm flex items-center">
              <span class="ml-1">âœ…</span> Ø³Ø§Ù„ ØªÙˆÙ„Ø¯ Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª
            </div>
          </div>

        </div>


        <!-- Ù†Ù…Ø§ÛŒØ´ Ø±Ø¯Ù‡ Ø³Ù†ÛŒ Ø¨Ù‡ ØµÙˆØ±Øª Ø¨Ø²Ø±Ú¯ØªØ± -->
        <div v-if="age && !errors.birthYear" class="mt-8 p-6 rounded-2xl border"
          :class="age < 13 ? 'bg-gradient-to-r from-yellow-500/30 to-orange-500/30 border-yellow-400/50' : 'bg-gradient-to-r from-blue-500/30 to-cyan-500/30 border-cyan-400/50'">
          <div class="flex items-center justify-between">
            <div>
              <h4 class="font-bold text-white text-xl mb-2">Ø±Ø¯Ù‡ Ø³Ù†ÛŒ ØªØ´Ø®ÛŒØµ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡:</h4>
              <div class="flex items-center space-x-4 space-x-reverse">
                <span :class="ageCategory.class" class="font-black text-lg px-4 py-2 rounded-xl">
                  {{ ageCategory.text }}
                </span>
                <div class="text-right mx-4">
                  <p class="text-sm text-cyan-200">ØªØ§Ø±ÛŒØ® Ù…Ø³Ø§Ø¨Ù‚Ù‡</p>
                  <p class="font-bold text-white text-sm">{{ age < 13 ? 'Û´ Ø¯ÛŒ Û±Û´Û°Û´' : 'Ûµ Ø¯ÛŒ Û±Û´Û°Û´' }}</p>
                </div>
                <div class="text-right mx-4">
                  <p class="text-sm text-cyan-200">Ø±ÙˆØ² Ù‡ÙØªÙ‡</p>
                  <p class="font-bold text-white text-sm">{{ age < 13 ? 'Ù¾Ù†Ø¬Ø´Ù†Ø¨Ù‡' : 'Ø¬Ù…Ø¹Ù‡' }}</p>
                </div>
                <div class="text-right mx-4">
                  <p class="text-sm text-cyan-300">Ø³Ù† Ø´Ù†Ø§Ú¯Ø±:</p>
                  <p class="font-bold text-white text-sm">{{ age }} Ø³Ø§Ù„</p>
                </div>
              </div>
            </div>
            <span class="text-4xl">{{ age < 13 ? 'ğŸ‘¦' : 'ğŸ‘¨' }}</span>
          </div>
        </div>

        <!-- Status summary -->
        <div v-if="hasValidFields"
          class="mt-6 p-4 rounded-xl bg-gradient-to-r from-emerald-500/10 to-green-500/10 border border-emerald-400/30">
          <div class="flex items-center justify-between">
            <div class="flex items-center">
              <div
                class="w-10 h-10 rounded-full bg-gradient-to-r from-emerald-500 to-green-600 flex items-center justify-center mx-3">
                <span class="text-lg">ğŸ“Š</span>
              </div>
              <div>
                <p class="text-sm text-cyan-200">ÙˆØ¶Ø¹ÛŒØª ØªÚ©Ù…ÛŒÙ„ ÙØ±Ù…</p>
                <p class="font-bold text-white">
                  {{ validFieldCount }} Ø§Ø² {{ totalRequiredFields }} ÙÛŒÙ„Ø¯ Ø§Ø¬Ø¨Ø§Ø±ÛŒ ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯
                </p>
              </div>
            </div>
            <div
              class="h-12 w-12 rounded-full bg-gradient-to-r from-emerald-500 to-green-600 flex items-center justify-center">
              <span class="font-bold text-white">{{ Math.round((validFieldCount / totalRequiredFields) * 100)
                }}%</span>
            </div>
          </div>
          <div class="mt-3 h-2 bg-white/10 rounded-full overflow-hidden">
            <div class="h-full bg-gradient-to-r from-emerald-500 to-green-600 rounded-full transition-all duration-500"
              :style="{ width: `${(validFieldCount / totalRequiredFields) * 100}%` }"></div>
          </div>
        </div>

        <!-- Error message -->
        <div v-if="generalError" class="mt-8 p-4 bg-red-500/20 border border-red-400/30 rounded-xl animate-shake">
          <div class="flex items-center text-red-300">
            <span class="ml-2 text-xl">â›”</span>
            <p>{{ generalError }}</p>
          </div>
        </div>

        <!-- Action buttons -->
        <div class="mt-10 pt-6 border-t border-white/10 flex flex-col sm:flex-row justify-between items-center gap-4">
          <button @click="back"
            class="group px-8 py-3 rounded-xl border-2 border-cyan-400/50 text-cyan-300 hover:bg-cyan-500/20 hover:border-cyan-400 hover:text-white transition-all duration-300 flex items-center justify-center w-full sm:w-auto">
            <span class="ml-2 transform group-hover:-translate-x-1 transition-transform">â†</span>
            Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ
          </button>

          <button @click="next" :disabled="isFormInvalid" :class="[
            'group px-10 py-4 rounded-xl text-white font-bold shadow-lg transition-all duration-500 flex items-center justify-center w-full sm:w-auto',
            isFormInvalid
              ? 'bg-gradient-to-r from-gray-600 to-gray-700 opacity-70 cursor-not-allowed'
              : 'bg-gradient-to-r from-cyan-500 to-blue-600 hover:shadow-cyan-500/30 hover:-translate-y-1'
          ]">
            <span v-if="isFormInvalid">Ù„Ø·ÙØ§Ù‹ ÙØ±Ù… Ø±Ø§ Ú©Ø§Ù…Ù„ Ú©Ù†ÛŒØ¯</span>
            <span v-else class="flex items-center">
              Ø§Ø¯Ø§Ù…Ù‡ Ø¨Ù‡ Ù…Ø±Ø­Ù„Ù‡ Ø¨Ø¹Ø¯
              <span class="mr-3 text-xl transform group-hover:translate-x-2 transition-transform">â†’</span>
            </span>
          </button>
        </div>

        <!-- Form steps indicator -->
        <div class="mt-8 flex justify-center">
          <div class="flex items-center space-x-2">
            <div class="w-10 h-2 rounded-full bg-cyan-500"></div>
            <div class="w-6 h-2 rounded-full bg-white/30"></div>
            <div class="w-6 h-2 rounded-full bg-white/30"></div>
            <div class="w-6 h-2 rounded-full bg-white/30"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { reactive, ref, computed, watch, onMounted } from "vue";
import { useRouter } from "vue-router";




const router = useRouter();

// Key Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø± localStorage
const STORAGE_KEY = 'swim_registration_form';

// Initialize form data from localStorage or empty
const local = reactive({
  name: "",
  fatherName: "",
  nationalCode: "",
  schoolName: "",
  swimSchoolName: "",
  coachName: "",
  birthYear: "",
  phone: ""
});

// Load data from localStorage on component mount
onMounted(() => {
  loadFromLocalStorage();

  // Ù‡Ù…Ú†Ù†ÛŒÙ† Ù…ÛŒØªÙˆØ§Ù†ÛŒÙ… Ú¯ÙˆØ´ Ø¯Ù‡Ù†Ø¯Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ú©Ø±Ø¯Ù† Ù‡Ù†Ú¯Ø§Ù… Ø¨Ø³ØªÙ‡ Ø´Ø¯Ù† ØµÙØ­Ù‡ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒÙ…
  window.addEventListener('beforeunload', saveToLocalStorage);

  // Ùˆ Ú¯ÙˆØ´ Ø¯Ù‡Ù†Ø¯Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¯ÙˆØ±Ù‡â€ŒØ§ÛŒ Ù‡Ø± 30 Ø«Ø§Ù†ÛŒÙ‡
  setInterval(saveToLocalStorage, 30000);
});

const errors = reactive({
  name: "",
  fatherName: "",
  nationalCode: "",
  schoolName: "",
  coachName: "",
  birthYear: "",
  phone: ""
});

const generalError = ref("");

// Functions for localStorage handling
function loadFromLocalStorage() {
  try {
    const savedData = localStorage.getItem(STORAGE_KEY);
    if (savedData) {
      const parsedData = JSON.parse(savedData);
      Object.assign(local, parsedData);

      // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ù…Ø¬Ø¯Ø¯ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯Ù‡
      if (local.name) validateName();
      if (local.fatherName) validateFatherName();
      if (local.nationalCode) validateNationalCode();
      if (local.schoolName) validateSchoolName();
      if (local.coachName) validateCoachName();
      if (local.birthYear) validateBirthYear();
      if (local.phone) validatePhone();

      console.log('Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø§Ø² LocalStorage Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯Ù†Ø¯');
    }
  } catch (error) {
    console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø§Ø² LocalStorage:', error);
    // Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§ØŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ù¾Ø§Ú© Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
    localStorage.removeItem(STORAGE_KEY);
  }
}

function saveToLocalStorage() {
  try {
    // ÙÙ‚Ø· ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒÛŒ Ú©Ù‡ Ù…Ù‚Ø¯Ø§Ø± Ø¯Ø§Ø±Ù†Ø¯ Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
    const dataToSave = {};
    Object.keys(local).forEach(key => {
      if (local[key] !== undefined && local[key] !== null && local[key] !== '') {
        dataToSave[key] = local[key];
      }
    });

    localStorage.setItem(STORAGE_KEY, JSON.stringify(dataToSave));
  } catch (error) {
    console.error('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¯Ø± LocalStorage:', error);
  }
}

// Functions for sessionStorage (Ù…Ø±Ø§Ø­Ù„ Ø¨Ø¹Ø¯ÛŒ)
function saveToSessionStorage() {
  sessionStorage.setItem("user-base", JSON.stringify(local));
}

// Computed properties (Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±)
const age = computed(() => {
  if (!local.birthYear || isNaN(local.birthYear)) return null;
  const currentYear = 1404;
  const birthYear = parseInt(local.birthYear);
  return currentYear - birthYear;
});

const ageCategory = computed(() => {
  if (!age.value) return { text: "", class: "" };
  if (age.value < 13) {
    return {
      text: "Ø²ÛŒØ± Û±Û² Ø³Ø§Ù„",
      class: "bg-gradient-to-r from-yellow-500 to-orange-500 text-white"
    };
  } else {
    return {
      text: "Ø¨Ø§Ù„Ø§ÛŒ Û±Û² Ø³Ø§Ù„",
      class: "bg-gradient-to-r from-blue-500 to-cyan-500 text-white"
    };
  }
});

// ØªØ¹Ø¯Ø§Ø¯ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ù…Ø¹ØªØ¨Ø±
const validFieldCount = computed(() => {
  const requiredFields = ['name', 'fatherName', 'nationalCode', 'schoolName', 'coachName', 'birthYear', 'phone'];
  return requiredFields.filter(field => {
    const value = String(local[field] || '').trim();
    return value !== '' && !errors[field];
  }).length;
});

// ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø§Ø¬Ø¨Ø§Ø±ÛŒ
const totalRequiredFields = computed(() => {
  return 7;
});

// Ø¢ÛŒØ§ Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© ÙÛŒÙ„Ø¯ Ù…Ø¹ØªØ¨Ø± Ø¯Ø§Ø±ÛŒÙ…ØŸ
const hasValidFields = computed(() => {
  return validFieldCount.value > 0;
});

const isFormInvalid = computed(() => {
  const requiredFields = ['name', 'fatherName', 'nationalCode', 'schoolName', 'coachName', 'birthYear', 'phone'];
  return requiredFields.some(field => {
    const value = String(local[field] || '').trim();
    return value === '' || errors[field];
  });
});

// Validation functions - Ø¨Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø±
function validateName() {
  const nameRegex = /^[\u0600-\u06FF\s]{2,50}$/;
  if (!local.name.trim()) {
    errors.name = "Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª";
  } else if (!nameRegex.test(local.name)) {
    errors.name = "Ù†Ø§Ù… Ø¨Ø§ÛŒØ¯ Ø­Ø§ÙˆÛŒ Ø­Ø±ÙˆÙ ÙØ§Ø±Ø³ÛŒ Ø¨Ø§Ø´Ø¯ (Ø­Ø¯Ø§Ù‚Ù„ Û² Ø­Ø±Ù)";
  } else {
    errors.name = "";
  }
  generalError.value = "";
  saveToLocalStorage(); // Ø°Ø®ÛŒØ±Ù‡ Ù¾Ø³ Ø§Ø² Ù‡Ø± ØªØºÛŒÛŒØ±
}

function validateFatherName() {
  const nameRegex = /^[\u0600-\u06FF\s]{2,50}$/;
  if (!local.fatherName.trim()) {
    errors.fatherName = "Ù†Ø§Ù… Ù¾Ø¯Ø± Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª";
  } else if (!nameRegex.test(local.fatherName)) {
    errors.fatherName = "Ù†Ø§Ù… Ù¾Ø¯Ø± Ø¨Ø§ÛŒØ¯ Ø­Ø§ÙˆÛŒ Ø­Ø±ÙˆÙ ÙØ§Ø±Ø³ÛŒ Ø¨Ø§Ø´Ø¯";
  } else {
    errors.fatherName = "";
  }
  generalError.value = "";
  saveToLocalStorage();
}

function validateNationalCode() {
  const code = local.nationalCode.trim();
  const nationalCodeRegex = /^\d{10}$/;
  const hasPersianDigits = /[\u06F0-\u06F9\u0660-\u0669]/.test(code);

  if (!code) {
    errors.nationalCode = "Ú©Ø¯ Ù…Ù„ÛŒ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª";
  } else if (hasPersianDigits) {
    errors.nationalCode = "Ù„Ø·ÙØ§Ù‹ ÙÙ‚Ø· Ø§Ø¹Ø¯Ø§Ø¯ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯";
  } else if (!nationalCodeRegex.test(code)) {
    errors.nationalCode = "Ú©Ø¯ Ù…Ù„ÛŒ Ø¨Ø§ÛŒØ¯ Û±Û° Ø±Ù‚Ù… Ø¨Ø§Ø´Ø¯";
  } else {
    // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… Ú©Ø¯ Ù…Ù„ÛŒ
    const sum = code.split('').slice(0, 9).reduce((acc, digit, index) =>
      acc + (parseInt(digit) * (10 - index)), 0);
    const remainder = sum % 11;
    const controlDigit = parseInt(code[9]);
    const isValid = (remainder < 2 && controlDigit === remainder) ||
      (remainder >= 2 && controlDigit === (11 - remainder));

    if (!isValid) {
      errors.nationalCode = "Ú©Ø¯ Ù…Ù„ÛŒ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª";
    } else {
      errors.nationalCode = "";
    }
  }

  generalError.value = "";
  saveToLocalStorage();
}

function validateSchoolName() {
  if (!local.schoolName.trim()) {
    errors.schoolName = "Ù†Ø§Ù… Ù…Ø¯Ø±Ø³Ù‡ ØªØ­ØµÛŒÙ„ÛŒ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª";
  } else if (local.schoolName.trim().length < 2) {
    errors.schoolName = "Ù†Ø§Ù… Ù…Ø¯Ø±Ø³Ù‡ Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ Û² Ø­Ø±Ù Ø¨Ø§Ø´Ø¯";
  } else {
    errors.schoolName = "";
  }
  generalError.value = "";
  saveToLocalStorage();
}

function validateCoachName() {
  const nameRegex = /^[\u0600-\u06FF\s]{2,50}$/;
  if (!local.coachName.trim()) {
    errors.coachName = "Ù†Ø§Ù… Ù…Ø±Ø¨ÛŒ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª";
  } else if (!nameRegex.test(local.coachName)) {
    errors.coachName = "Ù†Ø§Ù… Ù…Ø±Ø¨ÛŒ Ø¨Ø§ÛŒØ¯ Ø­Ø§ÙˆÛŒ Ø­Ø±ÙˆÙ ÙØ§Ø±Ø³ÛŒ Ø¨Ø§Ø´Ø¯";
  } else {
    errors.coachName = "";
  }
  generalError.value = "";
  saveToLocalStorage();
}

function validateBirthYear() {
  const year = parseInt(local.birthYear);
  const currentYear = 1404;

  if (!local.birthYear) {
    errors.birthYear = "Ø³Ø§Ù„ ØªÙˆÙ„Ø¯ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª";
  } else if (isNaN(year)) {
    errors.birthYear = "Ø³Ø§Ù„ ØªÙˆÙ„Ø¯ Ø¨Ø§ÛŒØ¯ Ø¹Ø¯Ø¯ Ø¨Ø§Ø´Ø¯";
  } else if (year < 1386 || year > currentYear - 6) {
    errors.birthYear = `Ø³Ø§Ù„ ØªÙˆÙ„Ø¯ Ø¨Ø§ÛŒØ¯ Ø¨ÛŒÙ† Û±Û³Û¸Û¶ ØªØ§ Û±Û³Û¹Û¸ Ø¨Ø§Ø´Ø¯`;
  } else if (currentYear - year < 6) {
    errors.birthYear = "Ø­Ø¯Ø§Ù‚Ù„ Ø³Ù† Ø´Ø±Ú©Øª Û¶ Ø³Ø§Ù„ Ø§Ø³Øª";
  } else {
    errors.birthYear = "";
  }
  generalError.value = "";
  saveToLocalStorage();
}

function validatePhone() {
  const phoneRegex = /^09\d{9}$/;
  const cleanedPhone = local.phone.replace(/[^\d]/g, '');

  if (!cleanedPhone) {
    errors.phone = "Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª";
  } else if (!phoneRegex.test(cleanedPhone)) {
    errors.phone = "Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª (Ø¨Ø§ Û°Û¹ Ø´Ø±ÙˆØ¹ Ø´ÙˆØ¯)";
  } else {
    errors.phone = "";
  }
  generalError.value = "";
  saveToLocalStorage();
}

// Watch for changes and validate - Ø¨Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ
watch(() => local.name, () => {
  if (local.name) {
    validateName();
    saveToLocalStorage();
  }
});

watch(() => local.fatherName, () => {
  if (local.fatherName) {
    validateFatherName();
    saveToLocalStorage();
  }
});

watch(() => local.nationalCode, () => {
  if (local.nationalCode) {
    validateNationalCode();
    saveToLocalStorage();
  }
});

watch(() => local.schoolName, () => {
  if (local.schoolName) {
    validateSchoolName();
    saveToLocalStorage();
  }
});

watch(() => local.swimSchoolName, () => {
  // Ù…Ø¯Ø±Ø³Ù‡ Ø´Ù†Ø§ Ø§Ø®ØªÛŒØ§Ø±ÛŒ Ø§Ø³ØªØŒ ÙÙ‚Ø· Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
  saveToLocalStorage();
});

watch(() => local.coachName, () => {
  if (local.coachName) {
    validateCoachName();
    saveToLocalStorage();
  }
});

watch(() => local.birthYear, () => {
  if (local.birthYear) {
    validateBirthYear();
    saveToLocalStorage();
  }
});

watch(() => local.phone, () => {
  if (local.phone) {
    validatePhone();
    saveToLocalStorage();
  }
});

function next() {
  // Validate all fields
  validateName();
  validateFatherName();
  validateNationalCode();
  validateSchoolName();
  validateCoachName();
  validateBirthYear();
  validatePhone();

  // Check if there are any errors
  const hasErrors = Object.values(errors).some(error => error !== "");
  const requiredFields = ['name', 'fatherName', 'nationalCode', 'schoolName', 'coachName', 'birthYear', 'phone'];
  const hasEmptyFields = requiredFields.some(field => !String(local[field] || '').trim());

  if (hasErrors || hasEmptyFields) {
    generalError.value = "Ù„Ø·ÙØ§Ù‹ ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø§Ø¬Ø¨Ø§Ø±ÛŒ Ø±Ø§ Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ ØªÚ©Ù…ÛŒÙ„ Ù†Ù…Ø§ÛŒÛŒØ¯";

    // Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¨Ù‡ Ø§ÙˆÙ„ÛŒÙ† ÙÛŒÙ„Ø¯ Ø¯Ø§Ø±Ø§ÛŒ Ø®Ø·Ø§
    const firstErrorField = Object.keys(errors).find(field => errors[field]);
    if (firstErrorField) {
      const inputElement = document.querySelector(`[v-model="local.${firstErrorField}"]`);
      if (inputElement) {
        inputElement.focus();
        inputElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    }
    return;
  }

  // Save to sessionStorage Ø¨Ø±Ø§ÛŒ Ù…Ø±Ø§Ø­Ù„ Ø¨Ø¹Ø¯ÛŒ
  saveToSessionStorage();

  // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† localStorage Ú†ÙˆÙ† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ù‡ sessionStorage Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯Ù†Ø¯
  localStorage.removeItem(STORAGE_KEY);

  // Ø­Ø°Ù event listenerÙ‡Ø§
  window.removeEventListener('beforeunload', saveToLocalStorage);

  router.push("/age");
}

function back() {
  // Ù‚Ø¨Ù„ Ø§Ø² Ø±ÙØªÙ† Ø¨Ù‡ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒØŒ Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
  saveToLocalStorage();
  router.push("/");
}

// Cleanup function
function cleanup() {
  window.removeEventListener('beforeunload', saveToLocalStorage);
}
</script>

<style>
/* Custom animations for water effects */
@keyframes float {
  0% {
    transform: translateY(0) rotate(0deg);
    opacity: 0;
  }

  10% {
    opacity: 0.3;
  }

  90% {
    opacity: 0.3;
  }

  100% {
    transform: translateY(-100vh) rotate(360deg);
    opacity: 0;
  }
}

@keyframes shake {

  0%,
  100% {
    transform: translateX(0);
  }

  10%,
  30%,
  50%,
  70%,
  90% {
    transform: translateX(-5px);
  }

  20%,
  40%,
  60%,
  80% {
    transform: translateX(5px);
  }
}

.animate-float {
  animation-name: float;
  animation-timing-function: linear;
  animation-iteration-count: infinite;
}

.animate-shake {
  animation: shake 0.5s ease-in-out;
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(6, 78, 120, 0.3);
}

::-webkit-scrollbar-thumb {
  background: linear-gradient(to bottom, #06b6d4, #3b82f6);
  border-radius: 4px;
}

/* Input number arrows hide */
input[type="number"]::-webkit-outer-spin-button,
input[type="number"]::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

input[type="number"] {
  -moz-appearance: textfield;
}

/* RTL support for number inputs */
.dir-ltr {
  direction: ltr;
  text-align: right;
}

/* Smooth transitions */
* {
  transition-property: background-color, border-color, transform, opacity;
  transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
  transition-duration: 300ms;
}
</style>
